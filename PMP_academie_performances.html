<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PMP – Préparation Mentale de Performances</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.banner img { max-width: 100%; height: auto; }
.card { border: 1px solid #ccc; border-radius: 8px; padding: 16px; margin: 16px 0; }
.btn { padding: 8px 12px; border: 1px solid #333; border-radius: 6px; cursor:pointer; margin-right:8px;}
</style>
</head>
<body>
<div class="banner"><img src="assets/bandeau.jpg" alt="Logo PMP"></div>
<h1>PMP – Préparation Mentale de Performances</h1>

<div class="card">
  <label>Identifiant participant : <input id="pid"></label>
  <label> Contexte :
    <select id="context">
      <option>Entraînement</option><option>Compétition</option><option>Scolaire</option>
    </select>
  </label>
  <label>Date : <input type="date" id="pdate"></label>
  <script>document.getElementById('pdate').valueAsDate = new Date();</script>
</div>

<div class="card" id="results">
  <h2>Résultats</h2>
  <p>Tableau des scores et graphique radar ici…</p>
</div>

<div class="card">
  <h2>Détail par item</h2>
  <p>Détail des réponses…</p>
</div>

<div class="card">
  <button class="btn" id="exportPdf">Exporter PDF</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
document.getElementById('exportPdf').addEventListener('click', async () => {
  const {{ jsPDF }} = window.jspdf;
  const doc = new jsPDF();

  const pid = document.getElementById('pid').value || "anonyme";
  const ctx = document.getElementById('context').value || "";
  const date = document.getElementById('pdate').value || "";

  // Page de garde
  const banner = document.querySelector('.banner');
  let canvas = await html2canvas(banner);
  let imgData = canvas.toDataURL('image/jpeg','1.0');
  doc.addImage(imgData,'JPEG',10,10,190,40);
  doc.setFontSize(16);
  doc.text("Préparation Mentale de Performances", 20, 70);
  doc.setFontSize(12);
  doc.text("Participant : "+pid, 20, 85);
  doc.text("Contexte : "+ctx, 20, 95);
  doc.text("Date : "+date, 20, 105);
  doc.addPage();

  // Résultats
  let resEl = document.getElementById('results');
  canvas = await html2canvas(resEl);
  imgData = canvas.toDataURL('image/jpeg','1.0');
  doc.addImage(imgData,'JPEG',10,20,190,0);
  doc.addPage();

  // Détail
  let detEl = document.querySelectorAll('.card')[2];
  canvas = await html2canvas(detEl);
  imgData = canvas.toDataURL('image/jpeg','1.0');
  doc.addImage(imgData,'JPEG',10,20,190,0);

  doc.save('PMP_resultats_'+pid+'_'+date+'.pdf');
});
</script>
</body>
</html>
